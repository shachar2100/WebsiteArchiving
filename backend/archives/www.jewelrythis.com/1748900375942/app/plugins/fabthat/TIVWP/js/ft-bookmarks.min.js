jQuery(function(e){var o=["liked",""],n=e("body").hasClass("logged-in"),k=parseInt(e(".bookmarks-count").first().text())||0;function a(t){this.$post=t,this.init&&this.init()}a.prototype.$=function(t){return this.$post.find(t)},a.prototype.toggleClass=function(t,o){return this.$post.toggleClass(t,o)},a.prototype.init=function(){this.post_id=this.$post.attr("class").match(/\bpost-(\d+)\b/)[1],this.is_own=this.$post.hasClass("my-post"),this.like_status=this.$post.hasClass("liked")?"liked":"",this.like_count=parseInt(this.$(".like-count").first().text())||0,this.bookmarked=this.$post.hasClass("bookmarked")},a.prototype.set=function(t){for(var o in t)this[o]=t[o];this.$post.change()},a.prototype.POST=function(t,o){if(this.post_id)return t={action:t,post_id:this.post_id},t=e.extend(t,o||{}),e.post(ajaxurl,t,null,"json")},a.prototype.set_like_status=function(t){this.is_own||-1===o.indexOf(t)||this.like_status===t||(this.set({like_count:this.like_count+("liked"===t?1:"liked"===this.like_status?-1:0),like_status:t}),this.POST("ft_like_status",{status:t}))},a.prototype.toggle_like=function(){this.set_like_status("liked"===this.like_status?"":"liked")},a.prototype.set_bookmark=function(t){this.bookmarked!=t&&this.toggle_bookmark()},a.prototype.toggle_bookmark=function(){k+=this.bookmarked?-1:1,this.set({bookmarked:!this.bookmarked}),this.POST("ft_toogle_bookmark")},a.prototype.tooltip=function(t){switch(t){case"like":return ft_bookmarks["liked"==this.like_status?"unlike_title":"like_title"];case"bookmark":return ft_bookmarks[this.bookmarked?"remove_bookmark_title":"add_bookmark_title"]}return""},e("body").on("mouseover",".btn-like,.btn-bookmark",function(t){var o,s,i=e(this).closest(".ftbm");i.length&&null!==i.attr("class").match(/\bpost-\d+\b/)&&!i.data("ft_bookmarks")&&((s=(i=e((i=i)[0])).data("ft_bookmarks"))||(s=new a(i),i.data("ft_bookmarks",s),i.change(function(){s.toggleClass("liked","liked"==s.like_status),s.toggleClass("has-likes",0<s.like_count),s.toggleClass("no-likes",0==s.like_count),s.toggleClass("bookmarked",s.bookmarked);var t=s.$(".like-count");t.length&&t.text(s.like_count||""),e(".user-bookmarks").toggleClass("empty",0==k).parent().toggleClass("empty",0==k),e(".bookmarks-count").text(k||"")}),o={trigger:"manual",placement:"top",container:"body",animation:!1,title:function(){return s.tooltip(e(this).hasClass("btn-like")?"like":e(this).hasClass("btn-bookmark")?"bookmark":"")}},s.is_own||i.on("mouseover",".btn-like",function(){e(this).tooltip(o).tooltip("show")}),i.on("mouseover",".btn-bookmark",function(){e(this).tooltip(o).tooltip("show")}),s.is_own||i.on("mouseleave",".btn-like",function(){e(this).tooltip(o).tooltip("hide")}),i.on("mouseleave",".btn-bookmark",function(){e(this).tooltip(o).tooltip("hide")}),s.is_own||i.on("click",".btn-like",function(t){t.preventDefault(),s.toggle_like()}),n?i.on("click",".btn-bookmark",function(){s.toggle_bookmark()}):ft_bookmarks.login_url&&i.on("click",".btn-bookmark",function(){var t=e(this).hasClass("btn-like")?"like":e(this).hasClass("btn-bookmark")?"bookmark":"";t&&(t={action:t,post_id:s.post_id},wpCookies.setHash("ft_bookmarks_action",t,"","/")),document.location=ft_bookmarks.login_url})),e(this).trigger(t.type))}),e("body").on("click",".btn-like,.btn-bookmark",function(){e(this).tooltip("show")})});