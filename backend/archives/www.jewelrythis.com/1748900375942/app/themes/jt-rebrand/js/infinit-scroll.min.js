jQuery(function($){var loading=!1,hide_selector=jt_infinit_scroll.hide_selector,page_selector=jt_infinit_scroll.page_selector,posts_selector=jt_infinit_scroll.posts_selector,container_selector=jt_infinit_scroll.container_selector,curr_page_selector=jt_infinit_scroll.curr_page_selector,next_page_selector=jt_infinit_scroll.next_page_selector,prev_page_selector=jt_infinit_scroll.prev_page_selector,page_loading_markup=jt_infinit_scroll.page_loading_markup,page_markup=jt_infinit_scroll.page_markup,range_markup=jt_infinit_scroll.range_markup,result_range_selector=jt_infinit_scroll.result_range_selector,result_range_first_selector=jt_infinit_scroll.result_range_first_selector,result_range_last_selector=jt_infinit_scroll.result_range_last_selector,result_range_total_selector=jt_infinit_scroll.result_range_total_selector,breadcrumb_selector=jt_infinit_scroll.breadcrumb_selector,breadcrumb_delimiter=jt_infinit_scroll.breadcrumb_delimiter,breadcrumb_page_selector=jt_infinit_scroll.breadcrumb_page_selector,breadcrumb_page_markup=jt_infinit_scroll.breadcrumb_page_markup,breadcrumb_page_format=jt_infinit_scroll.breadcrumb_page_format,breadcrumb_range_format=jt_infinit_scroll.breadcrumb_range_format,$container=$(container_selector),first_page,last_page,next_page,prev_page,last_scroll_top,$viewing_page,ignore_scroll;function render_page(e){var t,r=$(page_markup).data("page",e.url).data("title",e.title).data("paged",e.paged).append(e.posts);return r.find(".page-link").attr("href",e.url),r.find(".page-number").text(e.paged),e.range&&((t=$(range_markup)).find(result_range_first_selector).text(e.range[0]),t.find(result_range_last_selector).text(e.range[1]),t.find(result_range_total_selector).text(e.range[2]),r.find(".range").html(t)),r}function clean_page_url(e){var t;return e&&(1<(t=e.split("?")).length?(t[1]=t[1].replace(/&?(no-sidebar|no-nav)=1/g,"").replace(/^&/,""),t[1].length?t.join("?"):t[0]):e)}function get_page(a,n){$.get(a,{"no-sidebar":1,"no-nav":1},function(e){var t=$(e),r=t.filter("title").html()||"";n({url:a,$html:t,posts:$(e).find(container_selector).children(),next:clean_page_url($(e).find(next_page_selector).attr("href")),prev:clean_page_url($(e).find(prev_page_selector).attr("href")),range:parse_result_range(t),paged:t.find(curr_page_selector).text(),title:r})})}function parse_result_range(e){return[e.find(result_range_first_selector).text(),e.find(result_range_last_selector).text(),e.find(result_range_total_selector).text()]}function update_result_range(e){e[0]&&$(result_range_selector).find(result_range_first_selector).text(e[0]),e[1]&&$(result_range_selector).find(result_range_last_selector).text(e[1]),e[2]&&$(result_range_selector).find(result_range_total_selector).text(e[2])}function update_page_crumb(e,t){var r=$(breadcrumb_selector).find(breadcrumb_page_selector);0==r.length&&(r=$(breadcrumb_page_markup),$(breadcrumb_selector).append(breadcrumb_delimiter).append(r)),r.html(breadcrumb_range_format.replace("{first}",e).replace("{last}",t))}function next_posts(){var r;!loading&&next_page&&(loading=!0,r=$(page_loading_markup).insertAfter($container),get_page(next_page,function(e){loading=!1,r.remove(),$container.append(render_page(e)),last_page=next_page,next_page=e.next;var t=parse_result_range($(result_range_selector));t[1]=e.range[1],update_result_range(t),update_page_crumb($(page_selector).first().data("paged"),e.paged)}))}function prev_posts(){var a;!loading&&prev_page&&(loading=!0,a=$(page_loading_markup).insertBefore($container),get_page(prev_page,function(e){loading=!1;var t=$container.find(posts_selector+":first"),r=$(document).scrollTop()-t.offset().top,t=(a.remove(),$container.prepend(render_page(e)),$(document).scrollTop(t.offset().top+r),first_page=prev_page,prev_page=e.prev,parse_result_range($(result_range_selector)));t[0]=e.range[0],update_result_range(t),update_page_crumb(e.paged,$(page_selector).last().data("paged"))}))}function position(expr){var vh=$(window).height(),vt=$(document).scrollTop(),vb=vt+vh,vc=vt+vh/2,ct=$container.offset().top,ch=$container.height(),cb=ct+ch,cc=ct+ch/2;return eval(expr)}function pos(expr,el){var vh=$(window).height(),vt=$(document).scrollTop(),vb=vt+vh,vc=vt+vh/2,t=$(el).offset().top,h=$(el).height(),b=t+h,c=t+h/2;return eval(expr)}0!=$container.length&&(first_page=document.location.href,last_page=document.location.href,next_page=$(next_page_selector).attr("href"),prev_page=$(prev_page_selector).attr("href"),next_page||prev_page)&&($(hide_selector).hide(),$.fn.most_visible=function(){var a=0,n=void 0;return this.each(function(e,t){var r=pos("Math.min(b,vb) - Math.max(t,vt)",t);a<r&&(a=r,n=t)}),$(n)},$container.html(render_page({url:first_page,paged:$(curr_page_selector).text(),posts:$(container_selector).children().remove(),title:$("title").text(),range:[$(result_range_selector).find(result_range_first_selector).text(),$(result_range_selector).find(result_range_last_selector).text(),$(result_range_selector).find(result_range_total_selector).text()]})),last_scroll_top=$(document).scrollTop(),$viewing_page=$(page_selector).most_visible().first(),ignore_scroll=!0,$(document).on("scroll",function(e){var t;(ignore_scroll=ignore_scroll&&0!=last_scroll_top)?(last_scroll_top=$(document).scrollTop(),setTimeout(function(){$(document).scrollTop(0)},10)):(t=$(document).scrollTop(),last_scroll_top<t?$(document).trigger("scroll-down"):t<last_scroll_top&&$(document).trigger("scroll-up"),last_scroll_top=t,(t=$(page_selector).most_visible()).length&&$viewing_page&&t.data("page")!=$viewing_page.data("page")&&($viewing_page=t.first(),$(document).trigger("page-change")))}),$(document).on("page-change",function(){var e,t;window.history&&window.history.replaceState&&(e=$viewing_page.data("page"),t=$viewing_page.data("title"),$(document).prop("title",t),window.history.replaceState({page:e},t,e))}),$(document).on("scroll-down",function(){position("cb - vh < vb")&&next_posts()}),$(document).on("scroll-up",function(){position("ct + vh > vt")&&prev_posts()}),$(document).scrollTop(0))});