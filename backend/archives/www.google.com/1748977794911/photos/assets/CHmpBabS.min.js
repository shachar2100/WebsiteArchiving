function l(i,t){window.dataLayer=window.dataLayer||[];const e={...t,event:i};window.dataLayer.push(e)}const r={FORM_SUBMITTING:"form:submitting",FORM_SUBMITTED:"form:submitted",SUCCESS_VISIBLE:"success:visible",ERROR_VISIBLE:"error:visible",FIELD_ERROR:"field:error"};class m extends HTMLElement{constructor(){super(...arguments),this.submitting=!1}connectedCallback(){this.form=this.getSlotElement("form"),this.success=this.getSlotElement("success"),this.error=this.getSlotElement("error"),this.init()}init(){this.form&&this.form.addEventListener("submit",t=>this.onFormSubmit(t))}async onFormSubmit(t){if(t.preventDefault(),this.submitting)return;this.resetFieldErrors(),this.toggleErorr(!1);const e=new FormData(this.form);if(!this.testFormValid(e))return;this.setSubmitting(!0);const n=this.form.action;try{const s=new URLSearchParams;for(const[o,c]of e.entries())s.append(o,c);if((await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:s})).status===200){this.onSuccess();const o=this.getAttribute("data-tracking-event");o&&l(o)}else this.toggleErorr(!0);this.setSubmitting(!1)}catch(s){console.error("failed to submit",s),this.toggleErorr(!0),this.setSubmitting(!1)}}resetFieldErrors(){const t=this.form.getElementsByClassName(r.FIELD_ERROR);for(const e of t)e.classList.remove(r.FIELD_ERROR)}testFormValid(t){let e=!1;const n=String(t.get("email"));if(!f(n)){const s=this.form.querySelector('[name="email"]');s&&s.classList.add(r.FIELD_ERROR),e=!0}if(this.form.querySelector('[name="collects-pii-spii-checkbox"]')){const s=t.get("collects-pii-spii-checkbox");if(String(s).toLowerCase()!=="true"){const a=this.form.querySelector('[name="collects-pii-spii-checkbox"]');a&&a.classList.add(r.FIELD_ERROR),e=!0}}return!e}onSuccess(){this.form&&this.form.classList.add(r.FORM_SUBMITTED),this.success&&this.success.classList.add(r.SUCCESS_VISIBLE)}setSubmitting(t){this.submitting=t,this.form.classList.toggle(r.FORM_SUBMITTING,t)}toggleErorr(t){this.error&&this.error.classList.toggle(r.ERROR_VISIBLE,t)}getSlotElement(t){return this.querySelector(`[data-slot="${t}"]`)}getSlotElements(t){return Array.from(this.querySelectorAll(`[data-slot="${t}"]`))}}function f(i){return i&&typeof i=="string"&&i.includes("@")}customElements.get("photos-fbx-form")||customElements.define("photos-fbx-form",m);
